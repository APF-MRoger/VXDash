Version 4
SHEET 1 1028 680
WIRE 448 -48 448 -80
WIRE 16 32 16 0
WIRE 448 64 448 32
WIRE 448 64 208 64
WIRE 448 80 448 64
WIRE 272 112 272 96
WIRE -224 128 -224 96
WIRE 208 128 208 64
WIRE 240 128 208 128
WIRE 448 128 448 80
WIRE 400 144 304 144
WIRE 16 160 16 112
WIRE 48 160 16 160
WIRE 240 160 48 160
WIRE 16 192 16 160
WIRE 272 192 272 176
WIRE -224 240 -224 208
WIRE 448 256 448 224
WIRE 16 304 16 272
WIRE 448 368 448 336
FLAG -224 96 5V
FLAG -224 240 0
FLAG 16 0 5V
FLAG 16 304 0
FLAG 48 160 Vref
FLAG 272 96 5V
FLAG 272 192 0
FLAG 448 368 0
FLAG 448 -80 5V
FLAG 448 80 Vset
SYMBOL voltage -224 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR InstName 5V
SYMATTR Value 5
SYMATTR SpiceLine Rser=10m
SYMBOL res 0 16 R0
SYMATTR InstName R2
SYMATTR Value 6k8
SYMBOL res 0 176 R0
SYMATTR InstName R3
SYMATTR Value 330k
SYMBOL OpAmps\\UniversalOpamp 272 144 R0
SYMATTR InstName U1
SYMBOL res 432 240 R0
SYMATTR InstName R1
SYMATTR Value {Rsense}
SYMBOL res 432 -64 R0
SYMATTR InstName R4
SYMATTR Value 22
SYMBOL pmos 400 224 M180
SYMATTR InstName M1
SYMATTR Value BSS84
TEXT -152 144 Left 2 ;Set Vref to 4.9V
TEXT -258 392 Left 2 !.op
TEXT 32 416 Left 2 !.step param Rsense 10 300 10
